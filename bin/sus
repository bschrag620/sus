#!/usr/bin/env ruby

require_relative '../lib/sus/config'
config = Sus::Config.load

require_relative '../lib/sus'
filter = Sus::Filter.new

$VERBOSE = true

if $VERBOSE
	output = config.output
	verbose = true
else
	output = Sus::Output::Null.new
	verbose = false
end

assertions = Sus::Assertions.default(output: output, verbose: verbose)

config.prepare(filter)

config.before_tests(assertions)
filter.call(assertions)
config.after_tests(assertions)

if assertions.failed.any?
	exit(1)
end
