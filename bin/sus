#!/usr/bin/env ruby

require_relative '../lib/sus'

def prepare(paths, registry)
	if paths&.any?
		paths.each do |path|
			registry.load(path)
		end
	else
		Dir.glob("test/**/*.rb").each do |path|
			registry.load(path)
		end
	end
end

filter = Sus::Filter.new
output = Sus::Output.default

prepare(ARGV, filter)

assertions = filter.call

if assertions.failed.any?
	output.puts
	
	assertions.failed.each do |failure|
		failure.output.append(output)
	end
end
